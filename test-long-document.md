# 长文档滚动测试

## 第一部分：开头内容

这是一个用来测试长文档滚动分页功能的测试文件。当文档内容超过两万字时，SmartReader应该能够正确处理滚动到新区域时的内容高亮。这个文档包含了大量的文本内容，用来模拟真实的长文档场景。

在这个测试中，我们需要验证以下几个关键功能：首先是初始加载时只处理可见区域的内容，其次是滚动时能够动态处理新进入视口的内容，最后是确保处理过的内容不会被重复处理。

当用户滚动文档时，插件应该能够检测到新的可见内容，并对这些内容应用相应的高亮处理。这个过程应该是无缝的，用户不应该感觉到任何延迟或卡顿。

## 第二部分：中间内容段落1

这里是文档的中间部分，用来测试滚动到中间位置时的处理效果。每个段落都包含足够的文字来测试不同的间隔值设置。当间隔值设置为较小的数值如5或10时，高亮的密度会比较高。当间隔值设置为较大的数值如50或100时，高亮的密度会相对较低。

我们需要确保无论间隔值设置为多少，算法都能正确工作。之前修复的模运算方法确保了即使间隔值很大，比如200或500，也能正确地进行高亮处理。这个修复解决了之前大间隔值无法正常工作的问题。

在测试过程中，用户应该注意观察不同样式选项的效果。加粗样式应该只显示加粗效果，颜色样式应该只显示颜色变化，下划线样式应该只显示下划线，而加粗下划线组合样式应该同时显示加粗、下划线和颜色变化。

## 第三部分：中间内容段落2

继续测试文档的中间部分内容。这部分内容用来验证当用户从顶部滚动到中间位置时，新出现的内容能够被正确处理。滚动事件监听器应该能够检测到视口的变化，并识别出新进入可见区域的元素。

可见性检测算法使用了改进的视口坐标计算方法，添加了缓冲区机制来提前处理即将进入视口的内容。这样可以确保用户在滚动时看到的内容已经被预先处理，提供更好的用户体验。

缓冲区的大小设置为半屏高度，这意味着当内容距离进入视口还有半屏距离时就会开始处理。这个设置在性能和用户体验之间取得了很好的平衡。

## 第四部分：中间内容段落3

这个段落继续提供测试内容，用来验证滚动处理的连续性和稳定性。在长文档中，用户可能会进行快速滚动，也可能会缓慢滚动，插件都应该能够正确处理这些情况。

快速滚动时，节流机制会防止过于频繁的处理操作，避免性能问题。节流延迟设置为200毫秒，这个时间既能保证响应性，又能避免不必要的重复处理。

缓慢滚动时，每次进入新区域的内容都会被及时处理，确保用户看到的内容都是经过高亮处理的。这种处理方式特别适合阅读长篇文章或研究论文的场景。

## 第五部分：中间内容段落4

这里提供更多的测试内容来验证分页处理的效果。分页处理的核心思想是将大文档分解为多个可管理的部分，只处理当前可见和即将可见的部分，而不是一次性处理整个文档。

这种方法的优势在于：首先，它显著提高了大文档的加载速度，因为不需要等待整个文档处理完成；其次，它减少了内存使用，因为不需要同时处理所有内容；最后，它提供了更好的用户体验，因为用户可以立即开始阅读已处理的内容。

在实现上，我们使用了改进的滚动事件处理机制，确保能够正确绑定到预览容器的滚动事件。之前的实现可能无法正确监听到滚动事件，导致分页功能无法正常工作。

## 第六部分：中间内容段落5

继续提供测试内容以验证长文档处理的各个方面。这个部分特别关注处理标记的正确性，确保已处理的元素不会被重复处理，同时未处理的元素能够被正确识别和处理。

处理标记使用CSS类`smart-reader-processed`来标识已经处理过的元素。这个标记在元素处理完成后添加，在清除处理时移除。标记系统确保了处理的幂等性，即多次处理同一个元素不会产生副作用。

在滚动过程中，可见性检测算法会检查每个元素是否已经有处理标记，如果有则跳过，如果没有则进行处理。这种机制确保了效率和正确性。

## 第七部分：样式测试内容

这个部分专门用来测试不同的高亮样式效果。用户可以在设置中切换不同的样式选项，然后观察这个部分的文字如何变化。

当选择"加粗"样式时，高亮的文字应该只显示加粗效果，没有下划线或颜色变化。当选择"颜色"样式时，高亮的文字应该只显示颜色变化，通常是红色，没有加粗或下划线。

当选择"下划线"样式时，高亮的文字应该只显示下划线效果，没有加粗或颜色变化。当选择"加粗下划线"样式时，高亮的文字应该同时显示加粗、下划线和颜色变化，这是最醒目的样式选项。

## 第八部分：间隔值测试内容

这个部分用来测试不同间隔值设置的效果。用户可以在设置中修改间隔值，然后观察高亮密度的变化。现在输入框的焦点问题已经修复，用户可以连续输入多位数字而不会失去焦点。

当间隔值设置为5时，每5个词或字符就会有一个被高亮，密度较高。当间隔值设置为10时，每10个词或字符才会有一个被高亮，密度适中。当间隔值设置为20或更大的值时，高亮密度会相应降低。

之前修复的模运算算法确保了即使间隔值设置为很大的数值，比如100、200或500，高亮功能仍然能够正常工作。这解决了之前大间隔值无法生效的问题。

## 第九部分：性能测试内容

这个部分用来测试插件在处理长文档时的性能表现。长文档处理的性能主要体现在几个方面：初始加载速度、滚动响应速度、内存使用情况和CPU使用情况。

初始加载速度得益于分页处理机制的改进，现在只处理可见区域的内容，大大减少了初始处理时间。滚动响应速度通过节流机制和缓冲区预处理得到了优化，确保滚动时的流畅性。

内存使用方面，由于不再一次性处理整个文档，内存占用得到了有效控制。CPU使用方面，通过避免重复处理和优化可见性检测算法，减少了不必要的计算开销。

## 第十部分：结尾测试内容

这是文档的最后部分，用来测试滚动到文档底部时的处理效果。当用户滚动到文档的最后部分时，这些内容应该能够被正确识别为新的可见内容并进行相应的处理。

文档底部的处理特别重要，因为这里往往是用户阅读的终点，需要确保所有内容都能被正确处理。同时，这里也是测试边界条件的好地方，比如文档末尾的处理、最后几个元素的可见性检测等。

通过这个完整的长文档测试，我们可以验证SmartReader插件在处理超长内容时的各项功能是否正常工作，包括分页处理、滚动响应、样式应用、间隔值处理等核心功能。

## 总结

这个测试文档包含了大量的文本内容，足以测试长文档滚动分页功能的各个方面。用户可以通过滚动这个文档来验证修复效果，确保所有内容都能被正确处理，无论是在文档的开头、中间还是结尾部分。

测试时请注意观察：
1. 初始加载时是否只处理了可见部分
2. 滚动时新内容是否能及时被处理
3. 不同样式选项是否显示正确的效果
4. 间隔值输入框是否能正常连续输入
5. 整体性能是否流畅无卡顿 